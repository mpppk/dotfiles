- hosts: gce_ubuntu
  user: yuki
  vars:
    username: yuki
    email: niboshiporipori@gmail.com
    go_get:
    - name: ghq
      url: github.com/motemen/ghq
    - name: fzf
      url: github.com/junegunn/fzf
    - name: hlb
      url: github.com/mpppk/hlb

  roles:
    - role: fubarhouse.golang
      become: yes
  tasks:
    - name: "apt-get install git"
      apt: pkg=git
      become: yes
    - git_config: name=user.name scope=global value="{{ username }}"
    - git_config: name=user.email scope=global value="{{ email }}"
    - git_config: name=core.editor scope=global value="vim"
    - name: "apt-get install tig"
      apt: pkg=tig
      become: yes
    - name: "apt-get install tmux"
      apt: pkg=tmux
      become: yes
    - name: install fish repo
      apt_repository:
        repo="ppa:fish-shell/release-2"
        state=present
        update_cache=yes
      when: ansible_distribution == "Ubuntu"
    - name: install fish
      apt: name=fish state=present
      become: yes
    - name: make the fisherman directory
      file:
        path="{{ ansible_env.HOME }}/.config/fish/functions"
        state=directory
        owner="{{ ansible_env.USER }}"
        mode=0755
        recurse=yes
    - name: install fisherman
      get_url:
        url="https://git.io/fisherman"
        dest="{{ ansible_env.HOME }}/.config/fish/functions/fisher.fish"
#    - name: configure | change default shell
#      user: name="{{ ansible_env.USER }}" shell="/usr/local/bin/fish"
#      become: yes
    - name: git checkout dotfiles
      git:
        repo: 'https://github.com/mpppk/dotfiles.git'
        dest: dotfiles
    - file:
        path: "{{ ansible_env.HOME }}/.config/fish/config.fish"
        state: touch
    - lineinfile:
        path: "{{ ansible_env.HOME }}/.config/fish/config.fish"
        line: 'set -x GOROOT /usr/local/go'
    - lineinfile:
        path: "{{ ansible_env.HOME }}/.config/fish/config.fish"
        line: 'set -x GOPATH {{ansible_env.USER}}/go'
    - lineinfile:
        path: "{{ ansible_env.HOME }}/.config/fish/config.fish"
        line: 'set -x PATH {{ansible_env.HOME}}/go/bin $GOROOT/bin $PATH'
